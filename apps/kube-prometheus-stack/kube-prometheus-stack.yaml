apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: kube-prometheus-stack
    namespace: apps
spec:
    interval: 5m
    chart:
        spec:
            version: 41.7.4
            chart: kube-prometheus-stack
            sourceRef:
                kind: HelmRepository
                name: prometheus-community
                namespace: apps
            interval: 60m
    install:
        crds: Create
    upgrade:
        crds: CreateReplace
    values:
        namespaceOverride: apps
        alertmanager:
            enabled: false
        prometheus:
            prometheusSpec:
                retention: 24h
                resources:
                    requests:
                        cpu: 200m
                        memory: 200Mi
                podMonitorNamespaceSelector: {}
                podMonitorSelector:
                    matchLabels:
                        app.kubernetes.io/component: monitoring
        grafana:
            defaultDashboardsTimezone: ${TIMEZONE}
            adminPassword: ENC[AES256_GCM,data:5fLuSqwc4ODBSOoTjkuHBAWuqXcAMoLFau5hfsEy,iv:HRqDXVEG7lwyHr+pz1SB0MkqaEryhSLKkEyuDy6f+8A=,tag:1YhvPlho7RqZQAssD5Obxw==,type:str]
            ingress:
                enabled: true
                ingressClassName: nginx
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt
                    hajimari.io/enable: "true"
                    hajimari.io/icon: fire
                    external-dns.alpha.kubernetes.io/target: "${DDNS}"
                hosts:
                    - grafana.${ROOT_DOMAIN}
                tls:
                    - hosts:
                        - grafana.${ROOT_DOMAIN}
                      secretName: letsencrypt-grafana
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age194r4u78jlkcg3waxh5ddpwe6y0pwenuhk9avnkmc3huzcpf26d0spa3ggf
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBrWUVmODNVdHVHQUFpalJQ
            V2JPWHdiL0tIYTFFbWxGZnFOdkVQbXd6TENzCjRneFdjRnlqWGY4SDJPMnU1Y0Jk
            YXovVkV3VU1iS2FXcmcxQzAxMHlmNkEKLS0tIGJnUm1GOVllMnpDTVY0UW5iQVdC
            Z2FzOHZsZDZlTVdOTTFRSk5CS1I5MG8Ks4BXbS5kl/jL5tu+9fgGhNFUPcGA6lDl
            wpGcFD4slPKHGSDmaugwRorKFLc7MQFVvcj0XkhhWffg/w+h571YHA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2022-11-03T16:07:35Z"
    mac: ENC[AES256_GCM,data:3Wz9aBkCHvzNl7DKuGehRk/PXD1b5L/a6S2VJNVD7ap0+D8RJb4h8tVmQEjgg/m032imOm0X8Jn4/w5XupTk9ZXpnbUszAlqV1Cx/yIJMo5+Cj3dAtm8V4LWo03CqpLjArojjhwmTsm9Puu4VQD/qH+q7s5oWiENUXyFrSefjqs=,iv:Rn7J8Qd8QPpwCfKw1V6lBDm3CKj1WlC/rqqCn72Qrfg=,tag:6ZBYSxLmrzdMB1KXj/0ztQ==,type:str]
    pgp: []
    encrypted_regex: ((?i)(pass($|word)|claim|secret($|[^N])|key|token|^data$|^stringData))
    version: 3.7.3
