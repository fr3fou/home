---
# yaml-language-server: $schema=https://kubernetes-schemas.ok8.sh/source.toolkit.fluxcd.io/helmrepository_v1.json
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: project-zot
spec:
  interval: 1h
  url: http://zotregistry.dev/helm-charts
---
# yaml-language-server: $schema=https://kubernetes-schemas.ok8.sh/helm.toolkit.fluxcd.io/helmrelease_v2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: zot
spec:
  interval: 15m
  chart:
    spec:
      chart: zot
      version: 0.1.64
      sourceRef:
        kind: HelmRepository
        name: project-zot
  values:
    replicaCount: 1
    image:
      repository: ghcr.io/project-zot/zot
      tag: v2.1.14
    service:
      type: ClusterIP
      port: 5000
    persistence: true
    pvc:
      create: true
      accessModes:
        - ReadWriteOnce
      storage: 50Gi
      storageClassName: longhorn
    mountConfig: true
    configFiles:
      config.json: |-
        {
          "distSpecVersion": "1.0.1",
          "storage": {
            "rootDirectory": "/var/lib/registry",
            "gc": true,
            "gcDelay": "1h",
            "gcInterval": "24h",
            "dedupe": true
          },
          "http": {
            "address": "0.0.0.0",
            "port": "5000"
          },
          "log": {
            "level": "info"
          },
          "extensions": {
            "search": {
              "enable": true,
              "cve": {
                "updateInterval": "24h"
              }
            },
            "scrub": {
              "enable": true,
              "interval": "24h"
            },
            "ui": {
              "enable": true
            },
            "sync": {
              "enable": true,
              "registries": []
            }
          }
        }
    strategy:
      type: Recreate
